#!/bin/sh

echo ">>> Generating Public Repo"

cd /srv/git/simon.psaux.de/ 
git clone -q home.git/ public_home_tmp.git/

rm -rf public_home.git/
mkdir public_home.git/
cd public_home.git/
git init -q --bare
echo "autogenerated export of my config repo" > description
cd ..

git clone -q public_home.git/ public_home_tmp2.git/

cd public_home_tmp.git/
cp -rf .bashrc .gitconfig .gitignore .icc .ssh .vim .vimrc .xscreensaver .xsession ../public_home_tmp2.git/
cd ..

cd public_home_tmp2.git/
echo -e '*\n!.gitignore\n' > .gitignore
env -i git add -f .gitignore
env -i git add -f .bashrc .gitconfig .gitignore .icc .ssh .vim .vimrc .xscreensaver .xsession 
env -i git commit -q -a -m "auto import - `date`" 
env -i git push origin master
cd ..

rm -rf public_home_tmp.git/
rm -rf public_home_tmp2.git/

